<!doctype html>
<html lang="en">
<head>
    <!-- Required meta tags -->
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

    <!-- Bootstrap CSS -->
    <link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/bootstrap/4.0.0/css/bootstrap.min.css" integrity="sha384-Gn5384xqQ1aoWXA+058RXPxPg6fy4IWvTNh0E263XmFcJlSAwiGgFAW/dAiS6JXm" crossorigin="anonymous">

    <title>Test Opener</title>
</head>
<body>
<!-- Optional JavaScript -->
<!-- jQuery first, then Popper.js, then Bootstrap JS -->
<script src="https://code.jquery.com/jquery-3.2.1.slim.min.js" integrity="sha384-KJ3o2DKtIkvYIK3UENzmM7KCkRr/rE9/Qpg6aAZGJwFDMVNA/GpGFF93hXpG5KkN" crossorigin="anonymous"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/popper.js/1.12.9/umd/popper.min.js" integrity="sha384-ApNbgh9B+Y1QKtv3Rn7W3mgPxhU9K/ScQsAP7hUibX39j7fakFPskvXusvfa0b4Q" crossorigin="anonymous"></script>
<script src="https://maxcdn.bootstrapcdn.com/bootstrap/4.0.0/js/bootstrap.min.js" integrity="sha384-JZR6Spejh4U02d8jOt6vLEHfe/JQGiRRSQQxSfFWpi1MquVdAyjUar5+76PVCmYl" crossorigin="anonymous"></script>
<script type="text/javascript">
    // <![CDATA[
    var editorWindow = null;
    var editorPage = "messageEditor.html";
    //var editorPageURL = new URL(editorPage);
    var editorPageOrigin = document.location.origin;
    var windowName = "open-pedigree";
    var sendWhenReady = false;
    var localStorageKey = 'pedigreeData';

    window.addEventListener('message',  function(event) {
      console.log("Got message");
      console.log(event);
      if (event.source == editorWindow && event.origin == editorPageOrigin){
        // the message is from editor window
        if (event.data.messageType === "open_pedigree_control"){
          if (event.data.message == "started" && sendWhenReady){
            var context = $("#context").val();
            var data = $("#data").val();
            var openPedigreeData = JSON.stringify({"context": context, "value": data}, null, 2)

            console.log("Sending data to editor");

            editorWindow.postMessage({"messageType": "open_pedigree_data", "openPedigreeData": openPedigreeData}, editorPageOrigin);
            sendWhenReady = false;
          }
        }
        else if (event.data.messageType === "open_pedigree_data"){
          console.log("Got data from editor");
          if (event.data.openPedigreeData){
            var messageData = JSON.parse(event.data.openPedigreeData);
            $("#context").val(messageData.context);
            $("#data").val(messageData.value);
            var FHIRdata = JSON.parse(messageData.value);
            if (FHIRdata){
              let foundSVG = false;
              if ("Composition" === FHIRdata.resourceType){
                if (FHIRdata.contained) {
                  for (let containedResource of FHIRdata.contained) {
                    if (containedResource.id === 'pedigreeImage') {
                      foundSVG = true;
                      svg = decodeURIComponent(escape(atob(containedResource.content.attachment.data)));
                      svg = svg.replace(/width=".*?"/, 'width="auto"')
                              .replace(/height=".*?"/, 'height="auto"');
                      break;
                    }
                  }
                }
              }
              else if ("Bundle" === FHIRdata.resourceType){
                if (FHIRdata.entry) {
                  for (let e of FHIRdata.entry) {
                    let containedResource = e.resource;
                    if ('DocumentReference' === containedResource.resourceType &&
                            'Pedigree Diagram of Family in SVG format' === containedResource.description){
                      foundSVG = true;
                      svg = decodeURIComponent(escape(atob(containedResource.content.attachment.data)));
                      svg = svg.replace(/width=".*?"/, 'width="auto"')
                              .replace(/height=".*?"/, 'height="auto"');
                      break;
                    }
                  }
                }
              }
              if (foundSVG){
                var container = document.getElementById("SVGContainer");
                container.innerHTML = svg;
              }
            }
          }
          else {
            $("#context").val("");
            $("#data").val("");
          }
        }
      }
    }, false);


    function openEditor(element){
        console.log("Opening panogram editor in a new window");

        var firstChar = '?';
        var pageToOpen = editorPage;
        var ontologyServer = $("#ontologyServer").val();
        if (ontologyServer) {
            pageToOpen += firstChar + 'ontologyServer=' + ontologyServer;
            firstChar = '&';
        }
        if($('#sctMode').is(':checked')){
            pageToOpen += firstChar + 'mode=SCT';
            firstChar = '&';
        }

        sendWhenReady = true;
        editorWindow = window.open(pageToOpen, windowName);
    }

    function clearData(element){
        console.log("Clearing");
        $("#context").val("");
        $("#data").val("");
        $("#SVGContainer").empty();
    }
    // ]]>
</script>


<h1>Test Opener</h1>

<div class="container-fluid">
    <form>
        <div class="form-group">
            <label for="context">Editor Context</label>
            <input type="text" class="form-control" id="context" aria-describedby="contextHelp" placeholder="Enter context">
            <small id="contextHelp" class="form-text text-muted">The context is sent to panogram and then returned with saved diagram data.</small>
        </div>
        <div class="form-group">
            <label for="ontologyServer">Ontology Server</label>
            <input type="text" class="form-control" id="ontologyServer" aria-describedby="contextHelp" placeholder="Enter Server of leave blank for default">
            <small id="ontologyHelp" class="form-text text-muted">The ontology server used to lookup disorders and phenotypes</small>
        </div>
        <div class="form-group">
            <label>Mode</label>
            <div class="form-control">
                <div class="form-check form-check-inline">
                    <input class="form-check-input" type="radio" name="mode" id="hpoMode" value="HPO" checked="checked">
                    <label class="form-check-label active" for="hpoMode">HPO</label>
                </div>
                <div class="form-check form-check-inline">
                    <input class="form-check-input" type="radio" name="mode" id="sctMode" value="SCT">
                    <label class="form-check-label" for="sctMode">SCT</label>
                </div>
            </div>
            <small class="form-text text-muted">Code system to use for disorders and phenotypes. The test example uses HPO, clear the input before changing to SCT</small>
        </div>
        <div class="form-group">
            <label for="data">Data</label>
            <textarea class="form-control" id="data" rows="10" readOnly="true">{
  "resourceType": "Composition",
  "status": "preliminary",
  "type": {
    "coding": {
      "system": "http://loinc.org",
      "code": "11488-4",
      "display": "Consult note"
    }
  },
  "subject": {
    "type": "Patient",
    "reference": "#pat"
  },
  "date": "2019-11-11T11:44:25-10:00",
  "title": "Pedigree Details",
  "section": [
    {
      "title": "Patient Condition",
      "entry": [
        {
          "type": "Condition",
          "reference": "#cond_0"
        },
        {
          "type": "Condition",
          "reference": "#cond_1"
        },
        {
          "type": "Observation",
          "reference": "#fmh_clinical_0_0"
        }
      ]
    },
    {
      "title": "Family History",
      "code": {
        "coding": {
          "system": "http://loinc.org",
          "code": "10157-6",
          "display": "History of family member diseases"
        }
      },
      "entry": [
        {
          "type": "FamilyMemberHistory",
          "reference": "#FMH_0"
        },
        {
          "type": "FamilyMemberHistory",
          "reference": "#FMH_1"
        },
        {
          "type": "FamilyMemberHistory",
          "reference": "#FMH_2"
        },
        {
          "type": "FamilyMemberHistory",
          "reference": "#FMH_3"
        },
        {
          "type": "FamilyMemberHistory",
          "reference": "#FMH_4"
        },
        {
          "type": "FamilyMemberHistory",
          "reference": "#FMH_5"
        },
        {
          "type": "FamilyMemberHistory",
          "reference": "#FMH_6"
        },
        {
          "type": "FamilyMemberHistory",
          "reference": "#FMH_7"
        },
        {
          "type": "FamilyMemberHistory",
          "reference": "#FMH_8"
        },
        {
          "type": "FamilyMemberHistory",
          "reference": "#FMH_9"
        },
        {
          "type": "FamilyMemberHistory",
          "reference": "#FMH_10"
        },
        {
          "type": "FamilyMemberHistory",
          "reference": "#FMH_11"
        },
        {
          "type": "FamilyMemberHistory",
          "reference": "#FMH_12"
        },
        {
          "type": "FamilyMemberHistory",
          "reference": "#FMH_13"
        },
        {
          "type": "FamilyMemberHistory",
          "reference": "#FMH_14"
        },
        {
          "type": "FamilyMemberHistory",
          "reference": "#FMH_15"
        },
        {
          "type": "FamilyMemberHistory",
          "reference": "#FMH_16"
        },
        {
          "type": "FamilyMemberHistory",
          "reference": "#FMH_17"
        },
        {
          "type": "FamilyMemberHistory",
          "reference": "#FMH_18"
        },
        {
          "type": "FamilyMemberHistory",
          "reference": "#FMH_19"
        },
        {
          "type": "FamilyMemberHistory",
          "reference": "#FMH_20"
        },
        {
          "type": "FamilyMemberHistory",
          "reference": "#FMH_21"
        },
        {
          "type": "FamilyMemberHistory",
          "reference": "#FMH_22"
        },
        {
          "type": "FamilyMemberHistory",
          "reference": "#FMH_23"
        }
      ]
    }
  ],
  "contained": [
    {
      "id": "pat",
      "resourceType": "Patient",
      "gender": "female",
      "birthDate": "1970-2-10",
      "name": [
        {
          "family": "Smith,",
          "given": [
            "Jane,"
          ]
        },
        {
          "use": "old",
          "family": "Cooper"
        }
      ]
    },
    {
      "resourceType": "Condition",
      "id": "cond_0",
      "subject": {
        "type": "Patient",
        "reference": "#pat"
      },
      "code": {
        "text": "234700"
      }
    },
    {
      "resourceType": "Condition",
      "id": "cond_1",
      "subject": {
        "type": "Patient",
        "reference": "#pat"
      },
      "code": {
        "text": "234750"
      }
    },
    {
      "resourceType": "FamilyMemberHistory",
      "id": "FMH_0",
      "status": "completed",
      "patient": {
        "type": "Patient",
        "reference": "#pat"
      },
      "name": "Jane Smith (Cooper)",
      "sex": {
        "coding": [
          {
            "system": "http://hl7.org/fhir/administrative-gender",
            "code": "female",
            "display": "Female"
          }
        ]
      },
      "relationship": {
        "coding": [
          {
            "system": "http://terminology.hl7.org/CodeSystem/v3-RoleCode",
            "code": "ONESELF",
            "display": "self"
          }
        ]
      },
      "extension": [
        {
          "url": "http://hl7.org/fhir/StructureDefinition/family-member-history-genetics-parent",
          "extension": [
            {
              "url": "type",
              "valueCodeableConcept": {
                "coding": [
                  {
                    "system": "http://terminology.hl7.org/CodeSystem/v3-RoleCode",
                    "code": "NMTH",
                    "display": "natural mother"
                  }
                ]
              }
            },
            {
              "url": "reference",
              "valueReference": {
                "reference": "#FMH_1"
              }
            }
          ]
        },
        {
          "url": "http://hl7.org/fhir/StructureDefinition/family-member-history-genetics-parent",
          "extension": [
            {
              "url": "type",
              "valueCodeableConcept": {
                "coding": [
                  {
                    "system": "http://terminology.hl7.org/CodeSystem/v3-RoleCode",
                    "code": "NFTH",
                    "display": "natural father"
                  }
                ]
              }
            },
            {
              "url": "reference",
              "valueReference": {
                "reference": "#FMH_2"
              }
            }
          ]
        },
        {
          "url": "http://hl7.org/fhir/StructureDefinition/family-member-history-genetics-observation",
          "valueReference": {
            "type": "Observation",
            "reference": "#fmh_clinical_0_0"
          }
        }
      ],
      "bornDate": "1970-02-10",
      "note": [
        {
          "text": "ONESELF\nTEST"
        }
      ],
      "condition": [
        {
          "code": {
            "text": "234700"
          }
        },
        {
          "code": {
            "text": "234750"
          }
        }
      ]
    },
    {
      "resourceType": "Observation",
      "id": "fmh_clinical_0_0",
      "status": "preliminary",
      "valueString": "HP:0012168",
      "subject": {
        "type": "Patient",
        "reference": "#pat"
      }
    },
    {
      "resourceType": "FamilyMemberHistory",
      "id": "FMH_1",
      "status": "completed",
      "patient": {
        "type": "Patient",
        "reference": "#pat"
      },
      "name": "Mary Cooper (Jordan)",
      "sex": {
        "coding": [
          {
            "system": "http://hl7.org/fhir/administrative-gender",
            "code": "female",
            "display": "Female"
          }
        ]
      },
      "relationship": {
        "coding": [
          {
            "system": "http://terminology.hl7.org/CodeSystem/v3-RoleCode",
            "code": "NMTH",
            "display": "natural mother"
          }
        ]
      },
      "extension": [
        {
          "url": "http://hl7.org/fhir/StructureDefinition/family-member-history-genetics-parent",
          "extension": [
            {
              "url": "type",
              "valueCodeableConcept": {
                "coding": [
                  {
                    "system": "http://terminology.hl7.org/CodeSystem/v3-RoleCode",
                    "code": "NMTH",
                    "display": "natural mother"
                  }
                ]
              }
            },
            {
              "url": "reference",
              "valueReference": {
                "reference": "#FMH_17"
              }
            }
          ]
        },
        {
          "url": "http://hl7.org/fhir/StructureDefinition/family-member-history-genetics-parent",
          "extension": [
            {
              "url": "type",
              "valueCodeableConcept": {
                "coding": [
                  {
                    "system": "http://terminology.hl7.org/CodeSystem/v3-RoleCode",
                    "code": "NFTH",
                    "display": "natural father"
                  }
                ]
              }
            },
            {
              "url": "reference",
              "valueReference": {
                "reference": "#FMH_18"
              }
            }
          ]
        }
      ],
      "bornDate": "1951-08-06",
      "note": [
        {
          "text": "NMTH"
        }
      ]
    },
    {
      "resourceType": "FamilyMemberHistory",
      "id": "FMH_2",
      "status": "completed",
      "patient": {
        "type": "Patient",
        "reference": "#pat"
      },
      "name": "Roger Cooper",
      "sex": {
        "coding": [
          {
            "system": "http://hl7.org/fhir/administrative-gender",
            "code": "male",
            "display": "Male"
          }
        ]
      },
      "relationship": {
        "coding": [
          {
            "system": "http://terminology.hl7.org/CodeSystem/v3-RoleCode",
            "code": "NFTH",
            "display": "natural father"
          }
        ]
      },
      "bornDate": "1949-03-08",
      "note": [
        {
          "text": "NFTH"
        }
      ]
    },
    {
      "resourceType": "FamilyMemberHistory",
      "id": "FMH_3",
      "status": "completed",
      "patient": {
        "type": "Patient",
        "reference": "#pat"
      },
      "name": "Tarzan Smith",
      "sex": {
        "coding": [
          {
            "system": "http://hl7.org/fhir/administrative-gender",
            "code": "male",
            "display": "Male"
          }
        ]
      },
      "relationship": {
        "coding": [
          {
            "system": "http://terminology.hl7.org/CodeSystem/v3-RoleCode",
            "code": "SIGOTHR",
            "display": "significant other"
          }
        ]
      },
      "bornDate": "1967-08-15",
      "note": [
        {
          "text": "SIGOTHR"
        }
      ]
    },
    {
      "resourceType": "FamilyMemberHistory",
      "id": "FMH_4",
      "status": "completed",
      "patient": {
        "type": "Patient",
        "reference": "#pat"
      },
      "name": "Bob Smith",
      "sex": {
        "coding": [
          {
            "system": "http://hl7.org/fhir/administrative-gender",
            "code": "male",
            "display": "Male"
          }
        ]
      },
      "relationship": {
        "coding": [
          {
            "system": "http://terminology.hl7.org/CodeSystem/v3-RoleCode",
            "code": "SON",
            "display": "natural son"
          }
        ]
      },
      "extension": [
        {
          "url": "http://hl7.org/fhir/StructureDefinition/family-member-history-genetics-parent",
          "extension": [
            {
              "url": "type",
              "valueCodeableConcept": {
                "coding": [
                  {
                    "system": "http://terminology.hl7.org/CodeSystem/v3-RoleCode",
                    "code": "NMTH",
                    "display": "natural mother"
                  }
                ]
              }
            },
            {
              "url": "reference",
              "valueReference": {
                "reference": "#FMH_0"
              }
            }
          ]
        },
        {
          "url": "http://hl7.org/fhir/StructureDefinition/family-member-history-genetics-parent",
          "extension": [
            {
              "url": "type",
              "valueCodeableConcept": {
                "coding": [
                  {
                    "system": "http://terminology.hl7.org/CodeSystem/v3-RoleCode",
                    "code": "NFTH",
                    "display": "natural father"
                  }
                ]
              }
            },
            {
              "url": "reference",
              "valueReference": {
                "reference": "#FMH_3"
              }
            }
          ]
        }
      ],
      "bornDate": "1990-08-01",
      "note": [
        {
          "text": "SON"
        }
      ]
    },
    {
      "resourceType": "FamilyMemberHistory",
      "id": "FMH_5",
      "status": "completed",
      "patient": {
        "type": "Patient",
        "reference": "#pat"
      },
      "name": "Anne Smith (Limet)",
      "sex": {
        "coding": [
          {
            "system": "http://hl7.org/fhir/administrative-gender",
            "code": "female",
            "display": "Female"
          }
        ]
      },
      "relationship": {
        "coding": [
          {
            "system": "http://terminology.hl7.org/CodeSystem/v3-RoleCode",
            "code": "DAUINLAW",
            "display": "daughter in-law"
          }
        ]
      },
      "bornDate": "1992-04-14",
      "note": [
        {
          "text": "DAUINLAW"
        }
      ]
    },
    {
      "resourceType": "FamilyMemberHistory",
      "id": "FMH_6",
      "status": "completed",
      "patient": {
        "type": "Patient",
        "reference": "#pat"
      },
      "name": "Jerry Smith",
      "sex": {
        "coding": [
          {
            "system": "http://hl7.org/fhir/administrative-gender",
            "code": "male",
            "display": "Male"
          }
        ]
      },
      "relationship": {
        "coding": [
          {
            "system": "http://terminology.hl7.org/CodeSystem/v3-RoleCode",
            "code": "GRNDSON",
            "display": "grandson"
          }
        ]
      },
      "extension": [
        {
          "url": "http://hl7.org/fhir/StructureDefinition/family-member-history-genetics-parent",
          "extension": [
            {
              "url": "type",
              "valueCodeableConcept": {
                "coding": [
                  {
                    "system": "http://terminology.hl7.org/CodeSystem/v3-RoleCode",
                    "code": "NFTH",
                    "display": "natural father"
                  }
                ]
              }
            },
            {
              "url": "reference",
              "valueReference": {
                "reference": "#FMH_4"
              }
            }
          ]
        },
        {
          "url": "http://hl7.org/fhir/StructureDefinition/family-member-history-genetics-parent",
          "extension": [
            {
              "url": "type",
              "valueCodeableConcept": {
                "coding": [
                  {
                    "system": "http://terminology.hl7.org/CodeSystem/v3-RoleCode",
                    "code": "NMTH",
                    "display": "natural mother"
                  }
                ]
              }
            },
            {
              "url": "reference",
              "valueReference": {
                "reference": "#FMH_5"
              }
            }
          ]
        }
      ],
      "bornDate": "2017-08-16",
      "note": [
        {
          "text": "GRNDSON"
        }
      ]
    },
    {
      "resourceType": "FamilyMemberHistory",
      "id": "FMH_7",
      "status": "completed",
      "patient": {
        "type": "Patient",
        "reference": "#pat"
      },
      "name": "Fred Astair",
      "sex": {
        "coding": [
          {
            "system": "http://hl7.org/fhir/administrative-gender",
            "code": "male",
            "display": "Male"
          }
        ]
      },
      "relationship": {
        "coding": [
          {
            "system": "http://terminology.hl7.org/CodeSystem/v3-RoleCode",
            "code": "STPFTH",
            "display": "stepfather"
          }
        ]
      },
      "bornDate": "1950-08-01",
      "deceasedDate": "1969-08-20",
      "note": [
        {
          "text": "STPFTH"
        }
      ]
    },
    {
      "resourceType": "FamilyMemberHistory",
      "id": "FMH_8",
      "status": "completed",
      "patient": {
        "type": "Patient",
        "reference": "#pat"
      },
      "name": "Karen Florence (Astair)",
      "sex": {
        "coding": [
          {
            "system": "http://hl7.org/fhir/administrative-gender",
            "code": "female",
            "display": "Female"
          }
        ]
      },
      "relationship": {
        "coding": [
          {
            "system": "http://terminology.hl7.org/CodeSystem/v3-RoleCode",
            "code": "HSIS",
            "display": "half-sister"
          }
        ]
      },
      "extension": [
        {
          "url": "http://hl7.org/fhir/StructureDefinition/family-member-history-genetics-parent",
          "extension": [
            {
              "url": "type",
              "valueCodeableConcept": {
                "coding": [
                  {
                    "system": "http://terminology.hl7.org/CodeSystem/v3-RoleCode",
                    "code": "NMTH",
                    "display": "natural mother"
                  }
                ]
              }
            },
            {
              "url": "reference",
              "valueReference": {
                "reference": "#FMH_1"
              }
            }
          ]
        },
        {
          "url": "http://hl7.org/fhir/StructureDefinition/family-member-history-genetics-parent",
          "extension": [
            {
              "url": "type",
              "valueCodeableConcept": {
                "coding": [
                  {
                    "system": "http://terminology.hl7.org/CodeSystem/v3-RoleCode",
                    "code": "NFTH",
                    "display": "natural father"
                  }
                ]
              }
            },
            {
              "url": "reference",
              "valueReference": {
                "reference": "#FMH_7"
              }
            }
          ]
        }
      ],
      "bornDate": "1969-08-06",
      "note": [
        {
          "text": "HSIS"
        }
      ]
    },
    {
      "resourceType": "FamilyMemberHistory",
      "id": "FMH_9",
      "status": "completed",
      "patient": {
        "type": "Patient",
        "reference": "#pat"
      },
      "name": "George Florence",
      "sex": {
        "coding": [
          {
            "system": "http://hl7.org/fhir/administrative-gender",
            "code": "male",
            "display": "Male"
          }
        ]
      },
      "relationship": {
        "coding": [
          {
            "system": "http://terminology.hl7.org/CodeSystem/v3-RoleCode",
            "code": "BROINLAW",
            "display": "brother-in-law"
          }
        ]
      },
      "bornDate": "1965-08-18",
      "note": [
        {
          "text": "BROINLAW"
        }
      ]
    },
    {
      "resourceType": "FamilyMemberHistory",
      "id": "FMH_10",
      "status": "completed",
      "patient": {
        "type": "Patient",
        "reference": "#pat"
      },
      "name": "Patrick Florence",
      "sex": {
        "coding": [
          {
            "system": "http://hl7.org/fhir/administrative-gender",
            "code": "male",
            "display": "Male"
          }
        ]
      },
      "relationship": {
        "coding": [
          {
            "system": "http://terminology.hl7.org/CodeSystem/v3-RoleCode",
            "code": "NEPHEW",
            "display": "nephew"
          }
        ]
      },
      "extension": [
        {
          "url": "http://hl7.org/fhir/StructureDefinition/family-member-history-genetics-parent",
          "extension": [
            {
              "url": "type",
              "valueCodeableConcept": {
                "coding": [
                  {
                    "system": "http://terminology.hl7.org/CodeSystem/v3-RoleCode",
                    "code": "NMTH",
                    "display": "natural mother"
                  }
                ]
              }
            },
            {
              "url": "reference",
              "valueReference": {
                "reference": "#FMH_8"
              }
            }
          ]
        },
        {
          "url": "http://hl7.org/fhir/StructureDefinition/family-member-history-genetics-parent",
          "extension": [
            {
              "url": "type",
              "valueCodeableConcept": {
                "coding": [
                  {
                    "system": "http://terminology.hl7.org/CodeSystem/v3-RoleCode",
                    "code": "NFTH",
                    "display": "natural father"
                  }
                ]
              }
            },
            {
              "url": "reference",
              "valueReference": {
                "reference": "#FMH_9"
              }
            }
          ]
        }
      ],
      "bornDate": "1992-08-19",
      "note": [
        {
          "text": "NEPHEW"
        }
      ]
    },
    {
      "resourceType": "FamilyMemberHistory",
      "id": "FMH_11",
      "status": "completed",
      "patient": {
        "type": "Patient",
        "reference": "#pat"
      },
      "name": "Sarah Cooper",
      "sex": {
        "coding": [
          {
            "system": "http://hl7.org/fhir/administrative-gender",
            "code": "female",
            "display": "Female"
          }
        ]
      },
      "relationship": {
        "coding": [
          {
            "system": "http://terminology.hl7.org/CodeSystem/v3-RoleCode",
            "code": "NSIS",
            "display": "natural sister"
          }
        ]
      },
      "extension": [
        {
          "url": "http://hl7.org/fhir/StructureDefinition/family-member-history-genetics-parent",
          "extension": [
            {
              "url": "type",
              "valueCodeableConcept": {
                "coding": [
                  {
                    "system": "http://terminology.hl7.org/CodeSystem/v3-RoleCode",
                    "code": "NMTH",
                    "display": "natural mother"
                  }
                ]
              }
            },
            {
              "url": "reference",
              "valueReference": {
                "reference": "#FMH_1"
              }
            }
          ]
        },
        {
          "url": "http://hl7.org/fhir/StructureDefinition/family-member-history-genetics-parent",
          "extension": [
            {
              "url": "type",
              "valueCodeableConcept": {
                "coding": [
                  {
                    "system": "http://terminology.hl7.org/CodeSystem/v3-RoleCode",
                    "code": "NFTH",
                    "display": "natural father"
                  }
                ]
              }
            },
            {
              "url": "reference",
              "valueReference": {
                "reference": "#FMH_2"
              }
            }
          ]
        }
      ],
      "bornDate": "1975-04-08",
      "note": [
        {
          "text": "NSIS"
        }
      ]
    },
    {
      "resourceType": "FamilyMemberHistory",
      "id": "FMH_12",
      "status": "completed",
      "patient": {
        "type": "Patient",
        "reference": "#pat"
      },
      "name": "Rachael Little (Cooper)",
      "sex": {
        "coding": [
          {
            "system": "http://hl7.org/fhir/administrative-gender",
            "code": "female",
            "display": "Female"
          }
        ]
      },
      "relationship": {
        "coding": [
          {
            "system": "http://terminology.hl7.org/CodeSystem/v3-RoleCode",
            "code": "NSIS",
            "display": "natural sister"
          }
        ]
      },
      "extension": [
        {
          "url": "http://hl7.org/fhir/StructureDefinition/family-member-history-genetics-parent",
          "extension": [
            {
              "url": "type",
              "valueCodeableConcept": {
                "coding": [
                  {
                    "system": "http://terminology.hl7.org/CodeSystem/v3-RoleCode",
                    "code": "NMTH",
                    "display": "natural mother"
                  }
                ]
              }
            },
            {
              "url": "reference",
              "valueReference": {
                "reference": "#FMH_1"
              }
            }
          ]
        },
        {
          "url": "http://hl7.org/fhir/StructureDefinition/family-member-history-genetics-parent",
          "extension": [
            {
              "url": "type",
              "valueCodeableConcept": {
                "coding": [
                  {
                    "system": "http://terminology.hl7.org/CodeSystem/v3-RoleCode",
                    "code": "NFTH",
                    "display": "natural father"
                  }
                ]
              }
            },
            {
              "url": "reference",
              "valueReference": {
                "reference": "#FMH_2"
              }
            }
          ]
        }
      ],
      "bornDate": "1970-02-10",
      "note": [
        {
          "text": "TWINSIS"
        }
      ]
    },
    {
      "resourceType": "FamilyMemberHistory",
      "id": "FMH_13",
      "status": "completed",
      "patient": {
        "type": "Patient",
        "reference": "#pat"
      },
      "name": "Kayla Florence (Johnson)",
      "sex": {
        "coding": [
          {
            "system": "http://hl7.org/fhir/administrative-gender",
            "code": "female",
            "display": "Female"
          }
        ]
      },
      "relationship": {
        "coding": [
          {
            "system": "http://terminology.hl7.org/CodeSystem/v3-RoleCode",
            "code": "FAMMEMB",
            "display": "family member"
          }
        ]
      },
      "bornDate": "2019-08-06"
    },
    {
      "resourceType": "FamilyMemberHistory",
      "id": "FMH_14",
      "status": "completed",
      "patient": {
        "type": "Patient",
        "reference": "#pat"
      },
      "name": "Paul Florence",
      "sex": {
        "coding": [
          {
            "system": "http://hl7.org/fhir/administrative-gender",
            "code": "male",
            "display": "Male"
          }
        ]
      },
      "relationship": {
        "coding": [
          {
            "system": "http://terminology.hl7.org/CodeSystem/v3-RoleCode",
            "code": "EXT",
            "display": "extended family member"
          }
        ]
      },
      "extension": [
        {
          "url": "http://hl7.org/fhir/StructureDefinition/family-member-history-genetics-parent",
          "extension": [
            {
              "url": "type",
              "valueCodeableConcept": {
                "coding": [
                  {
                    "system": "http://terminology.hl7.org/CodeSystem/v3-RoleCode",
                    "code": "NFTH",
                    "display": "natural father"
                  }
                ]
              }
            },
            {
              "url": "reference",
              "valueReference": {
                "reference": "#FMH_10"
              }
            }
          ]
        },
        {
          "url": "http://hl7.org/fhir/StructureDefinition/family-member-history-genetics-parent",
          "extension": [
            {
              "url": "type",
              "valueCodeableConcept": {
                "coding": [
                  {
                    "system": "http://terminology.hl7.org/CodeSystem/v3-RoleCode",
                    "code": "NMTH",
                    "display": "natural mother"
                  }
                ]
              }
            },
            {
              "url": "reference",
              "valueReference": {
                "reference": "#FMH_13"
              }
            }
          ]
        }
      ],
      "bornDate": "2018-08-08",
      "note": [
        {
          "text": "GNEPHEW"
        }
      ]
    },
    {
      "resourceType": "FamilyMemberHistory",
      "id": "FMH_15",
      "status": "completed",
      "patient": {
        "type": "Patient",
        "reference": "#pat"
      },
      "name": "John Little",
      "sex": {
        "coding": [
          {
            "system": "http://hl7.org/fhir/administrative-gender",
            "code": "male",
            "display": "Male"
          }
        ]
      },
      "relationship": {
        "coding": [
          {
            "system": "http://terminology.hl7.org/CodeSystem/v3-RoleCode",
            "code": "BROINLAW",
            "display": "brother-in-law"
          }
        ]
      },
      "bornDate": "1969-10-22",
      "note": [
        {
          "text": "BROINLAW"
        }
      ]
    },
    {
      "resourceType": "FamilyMemberHistory",
      "id": "FMH_16",
      "status": "completed",
      "patient": {
        "type": "Patient",
        "reference": "#pat"
      },
      "name": "Frank Little",
      "sex": {
        "coding": [
          {
            "system": "http://hl7.org/fhir/administrative-gender",
            "code": "male",
            "display": "Male"
          }
        ]
      },
      "relationship": {
        "coding": [
          {
            "system": "http://terminology.hl7.org/CodeSystem/v3-RoleCode",
            "code": "NEPHEW",
            "display": "nephew"
          }
        ]
      },
      "extension": [
        {
          "url": "http://hl7.org/fhir/StructureDefinition/family-member-history-genetics-parent",
          "extension": [
            {
              "url": "type",
              "valueCodeableConcept": {
                "coding": [
                  {
                    "system": "http://terminology.hl7.org/CodeSystem/v3-RoleCode",
                    "code": "NMTH",
                    "display": "natural mother"
                  }
                ]
              }
            },
            {
              "url": "reference",
              "valueReference": {
                "reference": "#FMH_12"
              }
            }
          ]
        },
        {
          "url": "http://hl7.org/fhir/StructureDefinition/family-member-history-genetics-parent",
          "extension": [
            {
              "url": "type",
              "valueCodeableConcept": {
                "coding": [
                  {
                    "system": "http://terminology.hl7.org/CodeSystem/v3-RoleCode",
                    "code": "NFTH",
                    "display": "natural father"
                  }
                ]
              }
            },
            {
              "url": "reference",
              "valueReference": {
                "reference": "#FMH_15"
              }
            }
          ]
        }
      ],
      "bornDate": "2003-08-03",
      "note": [
        {
          "text": "NEPHEW"
        }
      ]
    },
    {
      "resourceType": "FamilyMemberHistory",
      "id": "FMH_17",
      "status": "completed",
      "patient": {
        "type": "Patient",
        "reference": "#pat"
      },
      "name": "Elizabeth Jordon (Gallaway)",
      "sex": {
        "coding": [
          {
            "system": "http://hl7.org/fhir/administrative-gender",
            "code": "female",
            "display": "Female"
          }
        ]
      },
      "relationship": {
        "coding": [
          {
            "system": "http://terminology.hl7.org/CodeSystem/v3-RoleCode",
            "code": "MGRMTH",
            "display": "maternal grandmother"
          }
        ]
      },
      "bornDate": "1933-04-26",
      "note": [
        {
          "text": "MGRMTH"
        }
      ]
    },
    {
      "resourceType": "FamilyMemberHistory",
      "id": "FMH_18",
      "status": "completed",
      "patient": {
        "type": "Patient",
        "reference": "#pat"
      },
      "name": "James Jordan",
      "sex": {
        "coding": [
          {
            "system": "http://hl7.org/fhir/administrative-gender",
            "code": "male",
            "display": "Male"
          }
        ]
      },
      "relationship": {
        "coding": [
          {
            "system": "http://terminology.hl7.org/CodeSystem/v3-RoleCode",
            "code": "MGRFTH",
            "display": "maternal grandfather"
          }
        ]
      },
      "bornDate": "1929-08-13",
      "note": [
        {
          "text": "MGRFTH"
        }
      ]
    },
    {
      "resourceType": "FamilyMemberHistory",
      "id": "FMH_19",
      "status": "completed",
      "patient": {
        "type": "Patient",
        "reference": "#pat"
      },
      "name": "Jill Gilliland (Jordan)",
      "sex": {
        "coding": [
          {
            "system": "http://hl7.org/fhir/administrative-gender",
            "code": "female",
            "display": "Female"
          }
        ]
      },
      "relationship": {
        "coding": [
          {
            "system": "http://terminology.hl7.org/CodeSystem/v3-RoleCode",
            "code": "MAUNT",
            "display": "maternal aunt"
          }
        ]
      },
      "extension": [
        {
          "url": "http://hl7.org/fhir/StructureDefinition/family-member-history-genetics-parent",
          "extension": [
            {
              "url": "type",
              "valueCodeableConcept": {
                "coding": [
                  {
                    "system": "http://terminology.hl7.org/CodeSystem/v3-RoleCode",
                    "code": "NMTH",
                    "display": "natural mother"
                  }
                ]
              }
            },
            {
              "url": "reference",
              "valueReference": {
                "reference": "#FMH_17"
              }
            }
          ]
        },
        {
          "url": "http://hl7.org/fhir/StructureDefinition/family-member-history-genetics-parent",
          "extension": [
            {
              "url": "type",
              "valueCodeableConcept": {
                "coding": [
                  {
                    "system": "http://terminology.hl7.org/CodeSystem/v3-RoleCode",
                    "code": "NFTH",
                    "display": "natural father"
                  }
                ]
              }
            },
            {
              "url": "reference",
              "valueReference": {
                "reference": "#FMH_18"
              }
            }
          ]
        }
      ],
      "note": [
        {
          "text": "MAUNT"
        }
      ],
      "condition": [
        {
          "code": {
            "text": "234700"
          }
        }
      ]
    },
    {
      "resourceType": "FamilyMemberHistory",
      "id": "FMH_20",
      "status": "completed",
      "patient": {
        "type": "Patient",
        "reference": "#pat"
      },
      "name": "Tom Gilliland",
      "sex": {
        "coding": [
          {
            "system": "http://hl7.org/fhir/administrative-gender",
            "code": "male",
            "display": "Male"
          }
        ]
      },
      "relationship": {
        "coding": [
          {
            "system": "http://terminology.hl7.org/CodeSystem/v3-RoleCode",
            "code": "FAMMEMB",
            "display": "family member"
          }
        ]
      },
      "note": [
        {
          "text": "MUNCLE"
        }
      ]
    },
    {
      "resourceType": "FamilyMemberHistory",
      "id": "FMH_21",
      "status": "completed",
      "patient": {
        "type": "Patient",
        "reference": "#pat"
      },
      "name": "Peter Gilliland",
      "sex": {
        "coding": [
          {
            "system": "http://hl7.org/fhir/administrative-gender",
            "code": "male",
            "display": "Male"
          }
        ]
      },
      "relationship": {
        "coding": [
          {
            "system": "http://terminology.hl7.org/CodeSystem/v3-RoleCode",
            "code": "MCOUSN",
            "display": "maternal cousin"
          }
        ]
      },
      "extension": [
        {
          "url": "http://hl7.org/fhir/StructureDefinition/family-member-history-genetics-parent",
          "extension": [
            {
              "url": "type",
              "valueCodeableConcept": {
                "coding": [
                  {
                    "system": "http://terminology.hl7.org/CodeSystem/v3-RoleCode",
                    "code": "NMTH",
                    "display": "natural mother"
                  }
                ]
              }
            },
            {
              "url": "reference",
              "valueReference": {
                "reference": "#FMH_19"
              }
            }
          ]
        },
        {
          "url": "http://hl7.org/fhir/StructureDefinition/family-member-history-genetics-parent",
          "extension": [
            {
              "url": "type",
              "valueCodeableConcept": {
                "coding": [
                  {
                    "system": "http://terminology.hl7.org/CodeSystem/v3-RoleCode",
                    "code": "NFTH",
                    "display": "natural father"
                  }
                ]
              }
            },
            {
              "url": "reference",
              "valueReference": {
                "reference": "#FMH_20"
              }
            }
          ]
        }
      ],
      "note": [
        {
          "text": "MCOUSIN"
        }
      ]
    },
    {
      "resourceType": "FamilyMemberHistory",
      "id": "FMH_22",
      "status": "completed",
      "patient": {
        "type": "Patient",
        "reference": "#pat"
      },
      "name": "Helen Gilliland",
      "sex": {
        "coding": [
          {
            "system": "http://hl7.org/fhir/administrative-gender",
            "code": "female",
            "display": "Female"
          }
        ]
      },
      "relationship": {
        "coding": [
          {
            "system": "http://terminology.hl7.org/CodeSystem/v3-RoleCode",
            "code": "FAMMEMB",
            "display": "family member"
          }
        ]
      }
    },
    {
      "resourceType": "FamilyMemberHistory",
      "id": "FMH_23",
      "status": "completed",
      "patient": {
        "type": "Patient",
        "reference": "#pat"
      },
      "name": "Treant Gilliland",
      "sex": {
        "coding": [
          {
            "system": "http://hl7.org/fhir/administrative-gender",
            "code": "male",
            "display": "Male"
          }
        ]
      },
      "relationship": {
        "coding": [
          {
            "system": "http://terminology.hl7.org/CodeSystem/v3-RoleCode",
            "code": "MCOUSN",
            "display": "maternal cousin"
          }
        ]
      },
      "extension": [
        {
          "url": "http://hl7.org/fhir/StructureDefinition/family-member-history-genetics-parent",
          "extension": [
            {
              "url": "type",
              "valueCodeableConcept": {
                "coding": [
                  {
                    "system": "http://terminology.hl7.org/CodeSystem/v3-RoleCode",
                    "code": "NFTH",
                    "display": "natural father"
                  }
                ]
              }
            },
            {
              "url": "reference",
              "valueReference": {
                "reference": "#FMH_21"
              }
            }
          ]
        },
        {
          "url": "http://hl7.org/fhir/StructureDefinition/family-member-history-genetics-parent",
          "extension": [
            {
              "url": "type",
              "valueCodeableConcept": {
                "coding": [
                  {
                    "system": "http://terminology.hl7.org/CodeSystem/v3-RoleCode",
                    "code": "NMTH",
                    "display": "natural mother"
                  }
                ]
              }
            },
            {
              "url": "reference",
              "valueReference": {
                "reference": "#FMH_22"
              }
            }
          ]
        }
      ],
      "note": [
        {
          "text": "MCOUSIN"
        }
      ]
    }
  ]
}
</textarea>
        </div>
        <button type="button" id="editButton" class="btn btn-primary" onclick="openEditor(this)">Edit</button>
        <button type="button" id="clearButton" class="btn btn-primary" onclick="clearData(this)">Clear</button>
    </form>
  <div class="row" id="SVGContainer">

  </div>
</div>
</body>
</html>
